<!doctype html>
const storageRef = storage.ref();


let selectedFile = null;


document.getElementById('imageFile').addEventListener('change', (e)=>{
const file = e.target.files[0];
selectedFile = file;
if(file){
const reader = new FileReader();
reader.onload = ev => document.getElementById('imagePreview').innerHTML = `<img src="${ev.target.result}" alt="Vorschau">`;
reader.readAsDataURL(file);
} else {
document.getElementById('imagePreview').innerHTML = '';
}
});


async function uploadImageAndGetURL(file, productId) {
const filePath = `images/products/${productId}/${file.name}`;
const imageRef = storageRef.child(filePath);
await imageRef.put(file);
return await imageRef.getDownloadURL();
}


document.getElementById('addForm').addEventListener('submit', async e => {
e.preventDefault();
const name = document.getElementById('name').value.trim();
const saveButton = document.getElementById('saveButton');
if(!name) return alert("Bitte Name eingeben");
saveButton.disabled = true;
saveButton.textContent = 'Speichern...';


try {
const newProductRef = productsRef.push();
const productId = newProductRef.key;
let imageUrl = 'https://via.placeholder.com/400x300?text=Kein+Bild';


if (selectedFile) imageUrl = await uploadImageAndGetURL(selectedFile, productId);


await newProductRef.set({
name: name,
image: imageUrl,
borrower: '',
borrowedSince: ''
});


alert("Produkt erfolgreich hinzugef√ºgt!");
window.location.href = 'index.html';
} catch (error) {
alert("Fehler: " + error.message);
} finally {
saveButton.disabled = false;
saveButton.textContent = 'Speichern';
}
});
</script>
</body>
</html>